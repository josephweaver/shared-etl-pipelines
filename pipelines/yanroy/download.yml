# This pipeline downloads the YanRoy field boundary data from Google Drive, 
# builds an AI dataset evidence bundle, catalogs the dataset in the AI research 
# catalog, and syncs the catalog metadata to a GitHub repository.

project_id: land_core
vars:
  dataset_id: "raw.yanroy_download_v1"
  name: yanroy
  gdrive_src: "Data/Field_Boundaries"
  # gdrive_glob: "cdl_codes_names.xlsx"
  gdrive_glob: "ReleaseData.7z"
  gdrive_shared_drive_name: "Land Core Risk Model Development"
  # Shared drive ID is optional; if set it overrides shared_drive_name in the plugin.
  gdrive_shared_drive_id: "0AKJcAvvAyp4oUk9PVA"
dirs:
  workdir: "{env.workdir}/yanroy/download/{sys.now.yymmdd}/{sys.now.hhmmss}-{sys.run.short_id}"
  logdir: "{workdir}/logs"
  rawdir: "{env.basedir}/data/yanroy/raw"
  fieldsdir: "{env.basedir}/data/yanroy/fields"

steps:
  - name: stage_raw_from_gdrive
    plugin: gdrive_download.py
    args:
      rclone_bin: "{env.rclone_bin}"
      src: "{gdrive_src}"
      out: "{rawdir}"
      glob: "{gdrive_glob}"
      recursive: true
      shared_drive: "{gdrive_shared_drive_name}"
      shared_drive_id: "{gdrive_shared_drive_id}"
    output_var: staged_raw
  - name: 02_unzip
    plugin: archive_extract.py
    args:
      archive_glob: "{archivedir}/ReleaseData.7z"
      out: "{fieldsdir}"
      include_glob: "**/*field_segments*.hdr,**/*field_segments"
 
