project_id: land_core
vars:
  dataset_id: raw.prism_ppt_monthly_800m_download_v1
  name: prism_download
  prism_base_url: ftp://prism.oregonstate.edu/time_series/us/an/800m/ppt/monthly
  years: "{expr.range(2018, 2019)}"
  prism_filename_glob: "*"
dirs:
  workdir: "{env.workdir}/{name}/{sys.now.yymmdd}/{sys.now.hhmmss}-{sys.run.short_id}"
  logdir: "{workdir}/logs"
  rawdir: "{env.basedir}/data/prism/ppt/daily"
  archivedir: "{rawdir}/archive"
  extractdir: "{rawdir}/raw"
steps:
  - name: "{sys.step.NN}_stage_prism_ftp"
    plugin: ftp_download_tree
    args:
      url: "{prism_base_url}/{item}"
      out: "{archivedir}/{item}"
      recursive: true
      filename_glob: "{prism_filename_glob}"
      overwrite: false
      timeout_seconds: 120
    foreach: years
    output_var: staged_raw
  - name: "{sys.step.NN}_extract_prism_archives"
    plugin: archive_extract
    args:
      archive_glob: "{archivedir}/{item}/**/*.zip"
      out: "{extractdir}/{item}"
      overwrite: true
    foreach: years
    output_var: extracted_raw
